<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <title>TODO ES6 도메인 패턴으로 랜더링하기</title>
    </head>
    <body>
        <script>
          const el = tag => document.createElement(tag);
          const err = v => {throw v;};

          const Task = class{
            constructor(title, isComplete = false){
              this.title = title;
              this.isComplete = isComplete;
            }
            setTitle(title){this.title = title;}
            toggle(){this.isComplete = !this.isComplete;}
            getInfo(){return {title:this.title, isComplete:this.isComplete};}
          };

          const Folder =
            class{
              constructor(title){
                this.title = title;
                this.tasks = new Set();
              }
              addTask(task){
                if(!(task instanceof Task)) err('invalidTask');
                this.tasks.add(task);
              }
              removeTask(task){
                if(!(task instanceof Task)) err('invalidTask');
                this.tasks.delete(task);
              }
              getTasks(){return [...this.tasks.values()];}
              getTitle(){return this.title;}
            };

          const App =
            class{
              constructor(){
                this.folders = new Set();
              }
              addFolder(folder){
                if(!(folder instanceof Folder)) err('invalidFolder');
                this.folders.add(folder);
              }
              removeFolder(folder){
                if(!(folder instanceof Folder)) err('invalidFolder');
                this.folders.delete(folder);
              }
              getFolders(){return [...this.folders.values()];}
            };

          const Renderer = class{
            constructor(app){this.app = app;}
            render(){this._render();}
            _render(){throw "render 메소드를 구현해주세요.";}
          };


          const DomRenderer = class extends Renderer{
            constructor(parent, app){
              super(app);
              const section = parent.appendChild(el('section'));
              section.innerHTML = '<nav><input/><ul></ul><nav><section><input/><ul></ul></section>';
              const [f, t] = section.querySelectorAll('input');
              f.addEventListener('keyup', e=>{
                if(e.keyCode != 13) return;
                const v = e.target.value.trim();
                e.target.value = '';
                if(!v) return;
                app.addFolder(new Folder(v));
                this.render();
              });
              t.addEventListener('keyup', e=>{
                if(e.keyCode != 13 || !this.current) return;
                const v = e.target.value.trim();
                e.target.value = '';
                if(!v) return;
                this.current.addTask(new Task(v));
                this.render();
              });
              const [folder, task] = section.
              querySelectorAll(
                'ul');
              this.folder = folder, this.task = task;
            }
            _render(){
              const folders = this.app.getFolders();
              if(!folders.length) return;
              if(!this.current) this.current = folders[0];
              this.folder.innerHTML = '';
              folders.forEach(f =>{
                const li = el('li');
                li.innerHTML = f.getTitle();
                li.style.color = this.current == f ? '#000' : '#777';
                li.addEventListener('click', e=>{this.current = f, this.render();});
                this.folder.appendChild(li);
              });
              if(!this.current) return;
              this.task.innerHTML = '';
              this.task.appendChild(...this.current.getTasks().map(t=>{
                const li = el('li'), {title, isComplete} = t.getInfo();
                li.innerHTML = (isComplete ? 'completed ' : 'process ') + title;
                li.addEventListener('click', e=>{t.toggle(), this.render();});
                return li;
              }));
            }
          };
          const todo = new DomRenderer(document.body, new App());

        </script>
    </body>
</html>